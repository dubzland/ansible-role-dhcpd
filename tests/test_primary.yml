---
- hosts: localhost
  remote_user: root
  roles:
    - role: dubzland-dhcpd
      vars:
        dubzland_dhcpd_interfaces:
          - "{{ ansible_default_ipv4.interface }}"
        dubzland_dhcpd_failovers:
          - name: dubzland-failover
            primary: "{{ ansible_default_ipv4.address }}"
            secondary: 10.0.10.3
            split: 128
        dubzland_dhcpd_keys:
          - name: dubzland
            secret: 1234567890ABCDEF
        dubzland_dhcpd_zones:
          - name: servers.local.dubzland.net
            primary: 10.0.10.2
            key: dubzland
        dubzland_dhcpd_groups:
          - options: |
              option domain-name "dubzland.net";
            subnets:
              - address: 10.0.10.0/24
                pools:
                  - range: 10.0.10.101 10.0.10.254
                    options: |
                      failover peer "dubzland-failover";
                options: |
                  option routers 10.0.10.1;
                  option domain-name-servers ns1.dubzland.net;
                  option domain-search "dubzland.net";
                  option ntp-servers 10.0.10.2;
            hosts:
              - hostname: server01
                address: 10.0.10.5
                mac: 01:0a:15:f3:16:a0;
  tasks:
    - name: grab dhcpd.conf
      command: /bin/cat /etc/dhcp/dhcpd.conf
      register: dhcpd_conf
    - name: dump dhcpd.conf
      debug:
        msg: "{{ dhcpd_conf.stdout_lines }}"
      when:
        dhcpd_conf is defined
